---
title: Examining spatial equity and accessibility to a public bicycle share program using a balanced floating catchment area approach 
author:
  - name: Elise Desjardins
    email: desjae@mcmaster.ca
    affiliation: Some School
    footnote: 1
  - name: Christopher D. Higgins
    email: cd.higgins@utoronto.ca
    affiliation: Another University
    footnote: 2
  - name: Antonio Paez
    email: paezha@mcmaster.ca
    affiliation: Some School
    footnote: 2
address:
  - code: McMaster University
    address: School of Earth, Environment & Society, 1280 Main Street West, Hamilton, ON L8S4L8
  - code: University of Toronto Scarborough
    address: Department of Geography & Planning, 1265 Military Trail, Toronto, ON M1C1A4
footnote:
  - code: 1
    text: "Corresponding Author"
  - code: 2
    text: "Equal contribution"
abstract: 
  
  Public bicycle share programs are implemented to promote cycling as a convenient and sustainable mode of transportation. These systems can also play a role in addressing transportation needs and advancing transportation equity if they make cycling more accessible to lower income or disadvantaged populations. Recent studies assessing equity in bike sharing have found differences in ridership or membership based on income, education, and trip purpose. In Ontario, the City of Hamilton launched a public bicycle share program in 2015 that currently has over 900 operational bicycles and 130 docking stations. In 2018, the non-profit organization that operates the program launched an equity initiative to provide subsidized memberships and to expand service by adding twelve docking stations. Previous research found that Hamiltonâ€™s public bicycle share program targeted well disadvantaged areas in the city compared to programs in other Canadian cities.  Since the time or distance that members of the population need to reach a bicycle share station decreases the potential of accessing the program, the location of stations matters. Unlike other public amenities with greater ability to adapt to crowding, the utility of stations is limited by the number of bicycles that they can hold, which makes crowding effects critical; the system may not necessarily be improved if stations are easy to reach but offer only a small number of bicycles. In this research, we revisit the case of Hamilton and investigate equity differentials in accessibility to bicycle share stations. We compare accessibility in the program with and without the equity stations to assess the effect of the initiative. Previous research on cycling equity or accessibility has used a macro-level approach with entire neighbourhoods or census tracts as the unit of analysis, although there are recent exceptions. In contrast, we implement our analysis parting from microscopic zones to better reflect travel to a docking station, which often happens at the sub-neighborhood level, and conduct a sensitivity analysis at several walking thresholds. We then reaggregate the estimated accessibility to dissemination areas for further analysis using census data. Equity analysis of this type is possible thanks to a newly developed approach for accessibility using balanced floating catchment areas. The addition of equity stations achieved its goal to increase accessibility for lower income populations, although the increase was relatively modest (2.10 bicycles/person with equity stations vs 1.97 bicycles/person without equity stations). Further research is needed to determine whether this encouraged more cycling.

journal: "Transportation Research Part D: Transport and Environment"
date: "`r Sys.Date()`"
bibliography: references.bib
#linenumbers: true
#numbersections: true
csl: elsevier-harvard.csl
output: rticles::elsevier_article
---

```{r, include=FALSE}
rm(list = ls())
```

```{r load-packages, include=FALSE}
library(data.table)
library(dplyr)
library(gdistance)
library(kableExtra)
library(raster)
library(rgdal)
library(sf)
library(sobiEquity)
library(tidyverse)
library(units)
#library(disk.frame)
#library(pycno)
library(readr)
#library(r5r) # the r5r package requires Java Development Kit version 11, which can be downloaded from https://www.oracle.com/java/technologies/javase-jdk11-downloads.html
library(tinytex)
library(ggplot2)
library(biscale)
library(cowplot)
```

```{r invoke-data, include=FALSE}
data("community_downtown")
data("hamilton_cma")
data("hamilton_da_2016")
data("population_50x50")
data("sobi_service")
data("sobi_hubs")
data("ttm_walk")
```

Background
===================

Public bicycle share programs (PBSP) have been implemented in over 800 cities worldwide and a great deal has been learned about their typical users [@fishmanBikeshareReviewRecent2016]. In many cities, males use bike share more than females [@breyWantRideMy2017; @nickkarSpatialtemporalGenderLand2019; @reillyGenderDisparitiesNew2020; @wintersWhoAreSuperusers2019] as do younger age cohorts [@breyWantRideMy2017; @buckAreBikeshareUsers2013; @fullerUseNewPublic2011]. However, one study found that bike share users in Washington, DC were more likely to be female [@buckAreBikeshareUsers2013], which suggests that the gender gap among cyclists who use bike share is less disparate than the gap for personal bicycle use [@fishmanBikeshareReviewRecent2016]. There is some evidence that bike share users are less likely to own a car [@buckAreBikeshareUsers2013; @reillyNoncyclistsFrequentCyclists2020]. However, the relationship between income or education and bike share use is less clear. Stations in disadvantaged communities in Chicago generated most of the average annual trips [@qianBikesharingEquityDisadvantaged2020] and individuals from minority or lower socioeconomic status neighbourhoods in Minneapolis-St. Paul used the city's PBSP more [@wangNeighborhoodSociodemographicCharacteristics2019]. Being university educated was also a significant correlate of bike share use in Montreal, Canada [@fullerUseNewPublic2011]. On the other hand, members who reside in minority-concentrated and lower socioeconomic status neighbourhoods use the Minneapolis-St Paul bike share more frequently [@wangNeighborhoodSociodemographicCharacteristics2019]. Financial savings have been found to motivate those on a low income to use bike share [@fishmanBikeshareReviewRecent2016]. Many studies have found that proximity to a bike share station, either living or working near one, is an important determinant of use or having a membership [@fishmanBikeshareReviewRecent2016; @fullerUseNewPublic2011]. This makes sense given that individuals are more likely to use services or programs that they can easily access. Finally, the potential of bike share programs to increase cycling levels has also been explored recently [@hosfordEvaluationImpactPublic2018; @hosfordEvaluatingImpactImplementing2019], but more longitudinal evidence is needed to determine their impact on encouraging more cycling and offering more opportunities for physical activity. On the whole, these findings highlight the need for bike share systems to be more highly accessible for diverse populations in order to increase use beyond the "typical" users, which has been the focus of recent research [@auchinclossDesignBaselineDescription2020; @hullgrassoBikeShareEquity2020; @macarthurAdaptiveBikeShare2020], and to offer more people the option of using sustainable and active transportation.

Several studies have recently explored the equity of PBSP in North American cities by primarily examining who has access to bike share (e.g., differences by demographics or socioeconomic status) and where stations are located. Equity can be achieved in two different ways: equal spatial distribution across a region (e.g., horizontal equity) or greater access for vulnerable or disadvantaged populations (e.g., vertical equity) [@chenExploringEquityPerformance2019]. Both are of interest to researchers and transport planners since they are often linked in that advantage, or conversely disadvantage, has spatial patterns. Using a negative binomial regression model, Qian and Jaller [-@qianBikesharingEquityDisadvantaged2020] estimated ridership in Chicago's PBSP among disadvantaged communities and found some disparities. While annual members in disadvantaged communities have a significantly lower share of trips compared to other areas in the city, they make longer trips. This suggests that they may be using PBSP for work commuting, which points to the importance of ensuring equitable access [@qianBikesharingEquityDisadvantaged2020]. Similar results were found in Philadelphia, where lower income areas generate fewer trips and efforts to increase equity within the program have not been as successful as intended [@caspiBikesharingPhiladelphiaLowerincome2019]. In the case of Seattle, all neighbourhoods had some level of access to dockless bikes but those with higher incomes and more residents of higher education had more bikes [@mooneyFreedomStationSpatial2019]. Babagoli et al. [-@babagoliExploringHealthSpatial2019] found that neighbourhoods in New York City with higher affluence had the greater proportion of Citi Bike stations. Overall, these findings suggest that horizontal equity can be achieved while vertical equity is harder to attain. Exploring transport equity by investigating where bicycle share stations are located, often using neighbourhoods or census tracts as the spatial unit of analysis, can ignore or miss the benefits that may be derived from adjacent zones. Meaning that, stations may be lacking in certain neighbourhoods but there may be stations accessible within a reasonable walking cutoff time. This is where accessibility becomes an important consideration.

Accessibility has been applied in both a positive and normative way to inform transportation planning [@paezMeasuringAccessibilityPositive2012], but its utility to this field has evolved since its conceptualization and become linked with recent interest in prioritizing local proximity and modes that are suitable for local trips like walking and cycling [@levineCenturyEvolutionAccessibility2020]. As a measure of the ease of reaching potential destinations spread spatially in a given area, accessibility is relevant to PBSPs because it can identify current inequities in usage, as well as guide interventions that increase access for groups that are under-serviced or address gaps in transportation options. It also addresses some of the challenges of other performance measures such as level of service within a transportation network by measuring person-based indicators and exploring differences in use between population groups [@paezMeasuringAccessibilityPositive2012].

In the context of PBSPs, accessibility refers to the distance an individual must travel to reach a bicycle share station [@kabraBikeShareSystemsAccessibility2020; @wangNewBikeShare2019]. Since the time or distance that members of the population need to reach a bicycle share station decreases the potential of accessing the program and ultimately use of the program, the location and size (e.g., maximum number of bicycles available) of stations matters. Indeed, distance to bicycle share stations is associated with use [@fullerUseNewPublic2011; @wangNewBikeShare2019] and can be a barrier to using PBSPs [@fishmanBarriersBikesharingAnalysis2014]. Kabra et al. [-@kabraBikeShareSystemsAccessibility2020] found that the majority of bike share usage in Paris comes from areas within 300m of stations. Furthermore, unlike other public amenities with greater ability to adapt to crowding, like health care services, the utility of stations is limited by the number of bicycles that they can hold, which makes crowding effects critical. The program may not necessarily be improved if stations are easy to reach but offer only a small number of bicycles. Likewise, more people may not opt to use the program if the supply of bicycles available at the nearest station is insufficient to meet demand. The location and size of stations is important to increase the utility of this public transportation option for more people, thus achieving vertical equity. Accessibility analyses for PBSPs constitute a positive and evaluation-based approach that also has the potential to inform equity efforts. For instance, Wang and Lindsey [-@wangNewBikeShare2019] investigated whether new or relocated bicycle share stations increased accessibility and use, which offered important insights to improve the performance of the program.

Several approaches have been commonly used for measuring accessibility: cumulative opportunities, gravity, and utility-based [@handyMeasuringAccessibilityExploration1997]. Paez et al [-@paezMeasuringAccessibilityPositive2012] provide a recent overview of various formulations and applications of accessibility in transportation research. Briefly, the gravity-based approach involves weighting opportunities, for example the quantity of bicycle share stations, as measured by a function of time, using a negative exponential form [@handyMeasuringAccessibilityExploration1997]. It takes both demand and congestion into account [@paezMeasuringAccessibilityPositive2012]. Floating catchment area (FCA) methods are a type of gravity measure that have been used in healthcare accessibility research but that are applicable to transportation case studies. This approach involves producing flexible catchment areas for populations, recognizing that people may be willing to travel to access particular services [@paezMeasuringAccessibilityPositive2012]. Thus, this model does a good job of considering potential crowding of services using a binary distance function [@paezMeasuringAccessibilityPositive2012]. A recent improvement to this approach was achieved through a simple and intuitive adjustment to the allocation of supply and demand, which addressed the effects of demand and service inflation from the conventional approach [see @paezDemandLevelService2019].

Researchers have also taken different approaches when it comes to aggregation of data, either by using the individual or household as the smallest unit of analysis or larger spatial zones. Previous research on bike share equity has typically used a macro-level approach with aggregate data from entire neighbourhoods or census tracts  [@babagoliExploringHealthSpatial2019; @mooneyFreedomStationSpatial2019; @qianBikesharingEquityDisadvantaged2020; @wangNeighborhoodSociodemographicCharacteristics2019], although there are recent exceptions [@chenExploringEquityPerformance2019; @chenUnobservedHeterogeneityTransportation2021]. This is also true for studies examining correlates of bike share demand [@wangNewBikeShare2019]. Handy and Niemeier [-@handyMeasuringAccessibilityExploration1997] note that using disaggregated data in accessibility analyses provides a more accurate estimate for individuals, which is useful for addressing vertical inequities in PBSP usage.

Using balanced floating catchment area methods, a novel approach that has not been used yet in cycling research, we examine accessibility to a public bicycle share program in Hamilton, Ontario. Using disaggregate population-level data, we (1) conduct a sensitivity analysis by measuring accessibility and level of service to bike share stations at different thresholds of walking to reach a station: 3 minutes, 5 minutes, 10 minutes, and 15 minutes; (2) explore the contribution of specific stations that were added to Hamilton's PBSP to reducing both horizontal and vertical inequities; and (3) examine whether disparities in accessibility exist according to median household income of dissemination areas within the core service area.

Case Study {#sec:study}
======================

This paper uses the city of Hamilton, located in Ontario, Canada, as a case study. The city launched a public bicycle share program, Hamilton Bike Share, in March 2015 with 115 stations and 750 bicycles [@hamiltonHamiltonBikeShare2015]. Before June 2020, the program was known as SoBi Hamilton. Stations are spaced between 300 and 600 metres apart [@scottRouteChoiceBike2021]. The core service area spans 35 km^2 of the city and roughly 138,000 can reach a bike share hub within 30 minutes of walking [see Figure 1]. This represents roughly one fifth of the population in Hamilton, according to the 2016 Canadian Census. The program was enthusiastically welcomed in the city - within three weeks of launching, 10,000 trips had been made [@hamiltonHamiltonBikeShare2015]. In 2017, Hamilton Bike Share Inc., the non-profit organization that operates the program, initiated an equity program, Everyone Rides Initiative (ERI), to remove barriers that may prevent individuals from accessing bike share in Hamilton. An additional 75 bicycles and 15 stations were added to the program, which expanded it to more disadvantaged areas in the core service area [see Figure 2]. The program also offers subsidized memberships to individuals who identify as low income. A comparable program can be found in Philadelphia [see @caspiBikesharingPhiladelphiaLowerincome2019]. As of June 2020, the bike share program has 900 bikes and 130 stations, and over 26,000 active memberships [@hamiltonHamiltonBikeShare2015]. 

Hamilton Bike Share has conducted one membership survey to date in 2018 [@civicplanSoBiHamiltonMembership2017], and the findings from 420 members are broadly in line with the trends that were discussed above [see @fishmanBikeshareReviewRecent2016 for a recent review of the literature]. The majority of respondents live within the core service area and the gender split is typical: 57% of respondents are male and 41% are female. The majority of respondents, both male and female, are between 25 and 34 years of age, but the percentage of male respondents is higher in the subsequent age groups. Respondents use bike share for commuting (40% of trips) or errands and meetings (24% of trips), and nearly 50% of trips have an average length of 11 to 20 minutes. As a result of having a bike share membership, 49% of respondents report that they use their private vehicle less often or much less often but 48% report that their private vehicle use has remained about the same. This suggests that SoBi Hamilton has been useful for certain kinds of trips but not all, meaning that some trips continue to require a private vehicle.

Further research has provided insights about the behaviour and route choice of bike share users in Hamilton. The routes most frequently travelled are longer than the shortest distance route from origin to destination [@luUnderstandingBikeShare2018; @scottRouteChoiceBike2021]. Ridership is influenced by weather conditions, temporal factors such as university terms, employment, and proximity to important destinations like the local university, but is not influenced by population and most transportation infrastructure variables [@scottWhatFactorsInfluence2019]. Bike share users prefer to deter from the shortest distance route to travel on streets with cycling facilities or lower volumes of traffic [@luUnderstandingBikeShare2018] and avoid steep slopes and busy roads [@scottRouteChoiceBike2021]. It is important to note that these studies used daily ridership or GPS data from trips taken before the equity stations were implemented, so these findings are informative with respect to the conventional stations. 

Our analysis builds upon a previous and recent study [@hosfordWhoArePublic2018], which found that disadvantaged areas in Hamilton are better served by the city's PBSP compared to other Canadian cities [i.e., Toronto, Vancouver, Montreal, and Ottawa-Gatineau] with PBSPs where advantaged areas have greater access. Hosford and Winters [-@hosfordWhoArePublic2018] acknowledge that "Hamilton stands out in that the lower income neighborhoods are located near the city center and wealthier neighborhoods are in the surrounding suburban areas". Therefore, the core service area for the PBSP in Hamilton is by default in more disadvantaged areas compared to other Canadian cities, but there is also a great deal of variation in income in the city center as well because of the local university and increasing gentrification in the downtown area. In their analysis, Hosford and Winters [-@hosfordWhoArePublic2018] did not differentiate between the conventional stations and those added to increase equity, which we refer to as equity stations in this paper. Therefore, this paper continues their work and makes an important contribution to the growing body of literature that examines equity issues in PBSPs.

```{r hamilton-and-sobi-service-area, echo=FALSE, fig.align = 'center', out.width = "65%", fig.cap = "The core service area of Hamilton Bike Share is outlined in blue. Dissemination areas in the Hamilton Census Metropolitan Area (CMA) are outlined in grey."}
ggplot() + 
  geom_sf(data = hamilton_da_2016,
          fill = NA,
          color = "gray") + 
  geom_sf(data = sobi_service,
          fill = NA,
          colour = "black")
```

```{r sobi-stations-in-hamilton, echo=FALSE, fig.align = 'center', out.width = "65%", fig.cap = "The spatial distribution of bike share stations in Hamilton, Ontario. The service area of Hamilton Bike Share is outlined in blue and the city's downtown core is outlined in light blue. Dissemination areas within the Hamilton CMA that touch the bounding box of the core service area are outlined in grey."}
ggplot() + 
  geom_sf(data = hamilton_da_2016 %>% 
            dplyr::filter(sobi_service == "Yes"),
          color = "gray") +
  geom_sf(data = sobi_service, 
          fill = NA,
          color = "black") +
  geom_sf(data = community_downtown %>%
            dplyr::filter(NAME == "Hamilton"),
          fill = "dark green",
          color = "dark green") +
  geom_sf(data = sobi_hubs %>% 
            dplyr::filter(hub_type == "Conventional" & 
                            hub_status == "Active"), # Remove deactivated hubs
          size = 1.5, 
          shape = 21, 
          fill = "blue") +
  geom_sf(data =  sobi_hubs %>% 
            dplyr::filter(hub_type == "ERI"), 
          size = 1.5, shape = 21, 
          fill = "green")
```

Methods {#sec:methods}
======================

## Floating Catchment Area

Floating catchment area (FCA) methods are an approach commonly used in the healthcare accessibility literature. This approach is more appropriate and informative than calculating the provider-to-population ratio (PPR) which simply divides the level of supply of a service (e.g., the number of bicycle racks at a station) by the population who have access to the service [@paezDemandLevelService2019]. In particular, the Two-Step Floating Catchment Area method produces flexible catchment areas for populations accessing a service rather than using rigid boundaries like PPR, which provides more useful information because it takes into account individual behaviour and doesn't assume that people stay within the pre-defined boundaries [@paezDemandLevelService2019]. This is an important property that supports our rationale for applying this method to measure accessibility to Hamilton Bike Share. The City of Hamilton has positioned stations between 300 and 600 metres apart, which would lead to boundaries around these buffers, but it would be reasonable to assume that people are willing to walk beyond this threshold to access other stations if the ones nearest them have no supply of bicycles.

More recently, the _balanced_ floating catchment area approach was developed to address issues with demand and supply inflation that are a result of the overlapping catchment areas produced by the Two-Step Floating Catchment Area [@paezDemandLevelService2019]. This overlap inflates the demand and generates inaccurate or misleading accessibility estimates [@paezDemandLevelService2019]. By adjusting the impedance weights, both supply and demand are proportionally allocated which eliminates the double-counting of population that leads to demand and supply inflation [@paezDemandLevelService2019]. Other benefits of this adjusted method include consideration of competition which can occur when catchment areas overlap, as well as the preservation of system-wide population and level of service. Balanced floating catchment area methods have been used to explore accessibility to health care providers [@paezDemandLevelService2019] and COVID-19 health care services [@pereiraGeographicAccessCOVID192021], but have not yet been used in the cycling literature to explore issues of accessibility.

In their review of accessibility measures, Geurs and van Wee [-@geursAccessibilityEvaluationLanduse2004] highlight the need for greater inclusion of individual spatio-temporal constraints but acknowledge the challenges of acquiring and analyzing person-based data. This comes after Kwan's [-@kwanSpaceTimeIntegral1998] work to show that space-time measures are more capable of capturing interpersonal differences, especially the effect of space-time constraints on individual behaviour, and are more helpful for unraveling gender/ethnic differences. Applying the balanced floating catchment area approach to examine accessibility to Hamilton Bike Share constitutes a location-based measure with an individual component by stratifying according to median household income [@geursAccessibilityEvaluationLanduse2004], but conducting a further sensitivity analysis by adjusting distance thresholds would introduce additional spatio-temporal constraints to evaluate equitable accessibility.

The first step in the balanced floating catchment area method is to allocate the population to be serviced by each Hamilton Bike Share station:
$$
P_j = {\sum_{i = 1}^{n} P_i{w_{ij}}}
$$

Next, the level of service at each station (i.e., the maximum number of bicycle racks) is divided by its estimated service population within the established catchment area:
$$
L_j = \frac {S_j}{P_j} = \frac {S_j}{{\sum_{i = 1}^{n} P_i{w_{ij}}}}
$$

Finally, the accessibility of population cell $i$ is calculated as the weighted sum of the level of service of all stations that can be reached from there according to normalized weights:
$$
A_i = {\sum_{j = 1}^{J} L_j{w_{ji}}} = {\sum_{j = 1}^{J} \frac {S_j{w_{ji}}}{\sum_{i = 1}^{n} P_i{w_{ij}}}}
$$

The approach uses instead a set of suitably normalized weights as follows:
$$
{w_{ij}^{i} = \frac {w_{ij}}{\sum_{j = 1}^{J} {w_{ji}}}}
$$

and
$$
{w_{ij}^{j} = \frac {w_{ij}}{\sum_{j = 1}^{J} {w_{ji}}}}
$$

These weights satisfy the following properties:
$$
\sum_{j = 1}^{J} {w^i_{ji}} = 1
$$

and
$$
\sum_{i = 1}^{n} {w^j_{ji}} = 1
$$

Finally, accessibility is calculated without risk of demand or supply inflation:
$$
A_i = {\sum_{j = 1}^{J} \frac {S_j{w^j_{ij}}}{\sum_{i = 1}^{n} P_i{w^i_{ij}}}}
$$

## Pycnophylactic Interpolation

We first plotted the population in all dissemination areas within SoBi Hamilton's core service area. Since pycnophylactic interpolation occurs at such a micro scale, we had to ensure that population numbers were not interpolated or allocated to areas where people do not live in Hamilton (i.e., where schools or parks are located). To do so, we retrieved shapefiles for various geographic features (see Table 1) from Open Hamilton. Figure 3 shows where these spaces are located within SoBi Hamilton's core service area. Next, we extracted these features from the PBSP core service area and used pycnophylactic interpolation to disaggregate and reallocate population from dissemination areas to smaller polygons. These micro-level polygons are 50 by 50 metres.

```{r data-features, echo=FALSE}
data_tbl <- data.frame(
  Feature = c("Hamilton Bike Share Stations", "Golf Courses", "Parks", "Designated Large Employment Areas", "Municipal Parking Lots", "Cemeteries", "Environmentally Sensitive Areas", "Streets", "Educational Institutions", "Places of Worship", "Municipal Service Centres", "Recreation and Community Centres", "Arenas", "Emergency Stations", "Fire Stations", "Police Stations", "Railways", "Hospitals"),
  Description = c(
    "The location of stations and the number of racks available at each station.",
    "The location of City and privately owned golf courses.", 
    "The location of parks and other green spaces.",
    "The location of large business parks and industrial lands.",
    "The location of municipal car parks.",
    "The location of cemeteries.",
    "The location of either land or water areas containing natural features or significant ecological functions.",
    "The street network in Hamilton, including road classification for highways.",
    "The location of all educational institutions and schools.",
    "The location of buildings used for religious congregations.",
    "The location of all municipal service centres, including City Hall.",
    "The location of all recreation and community centres.",
    "The location of all indoor arenas.",
    "The location of all Emergency Management Services (EMS) Ambulance stations.",
    "The location of all fire stations.",
    "The location of all police stations.",
    "The railway network in Hamilton.",
    "The location of all hospitals."
  )
)

kbl(data_tbl) %>%
  kable_paper(full_width = F) %>%
  column_spec(1, bold = T, border_right = T) %>%
  column_spec(2, width = "30em") %>%
  kable_styling(bootstrap_options = "striped")
```

## Travel Time Matrix

[BBBike](https://download.bbbike.org/osm/bbbike/) is an online cycle route planner that interfaces with OpenStreetMap. We extracted OpenStreetMap data for SoBi Hamilton's service area to calculate walking times from each population cell to nearby bike share stations, using a walking distance of 10km and a walking time of 30 minutes as a threshold. A travel time matrix was created with the origins as the coordinates of the population cells and the destinations as the coordinates of the bike share stations within the maximum threshold.

## Data

All data for this research were accessed from Open Hamilton^[https://open.hamilton.ca/], an online repository of data curated by the City of Hamilton. 

Results
===================

```{r figure-2, echo=FALSE, fig.align = 'center', out.width = "65%", fig.cap = "Population in all dissemination areas in the SoBi Hamilton core service area and within 30 minutes of walking to a bike share station."}
ggplot() +
  geom_sf(data = hamilton_da_2016 %>%
            dplyr::filter(sobi_service == "Yes"),
          aes(fill = population),
          color = NA) +
  geom_sf(data = sobi_service,
          fill = NA) +
  scale_fill_distiller(palette = "YlOrRd", 
                       direction = 1)
```


```{r figure-4, echo=FALSE, fig.align = 'center', out.width = "65%", fig.cap = "Interpolated population cells in the SoBi Hamilton core service area (outlined in black) and within 30 minutes of walking to the core service area (outlined in blue). The downtown area is outlined in dark green. Geographic features have been extracted. Dissemination area polygons are outlined in grey."}
ggplot() + 
  geom_sf(data = population_50x50,
          aes(color = population)) +
  scale_color_distiller(palette = "YlOrRd", 
                        direction = 1) +
  geom_sf(data = hamilton_da_2016 %>%
            filter(sobi_service == "Yes"),
          fill = NA,
          color = "lightgray") + 
  geom_sf(data = sobi_service,
          fill = NA,
          colour = "black") +
  geom_sf(data = community_downtown %>%
            dplyr::filter(NAME == "Hamilton"),
          fill = NA,
          color = "dark green")
```

```{r figure-5, echo=FALSE, fig.align = 'center', out.width = "65%", fig.cap = "Interpolated population cells in the SoBi Hamilton core service area and within 30 minutes of walking to the core service area. Green circles represent the location of the equity stations that were added in 2018. Blue circles represent the conventional stations. The service area of the PBSP is outlined in black, and dissemination areas from the 2016 Canadian Census are outlined in light gray."}
ggplot() + 
  geom_sf(data = population_50x50, 
          aes(color = population)) +
  geom_sf(data = hamilton_da_2016 %>%
            dplyr::filter(sobi_service == "Yes"), 
          fill = NA, 
          color = "lightgray") + 
  geom_sf(data = sobi_hubs %>% 
            dplyr::filter(hub_type == "Conventional" &
                            hub_status == "Active"), 
          size = 1.5, 
          shape = 21, 
          fill = "blue") +
  geom_sf(data =  sobi_hubs %>% 
            dplyr::filter(hub_type == "ERI"), 
          size = 1.5, shape = 21, 
          fill = "green") +
  geom_sf(data = sobi_service, 
          fill = NA, 
          colour = "black") +
  scale_color_distiller(palette = "YlOrRd", 
                        direction = 1) +
  geom_sf(data = community_downtown %>%
            dplyr::filter(NAME == "Hamilton"),
          fill = NA,
          color = "dark green") +
  facet_grid(rows = vars(hub_type))
```

## Accessibility at Different Thresholds

Consensus regarding the distance that individuals are willing to walk to access a PBSP is lacking, therefore the literature on walking behaviour was consulted to determine the thresholds for the sensitivity analysis. Previous studies have found that living within 250 metres [@fullerUseNewPublic2011] and 300 metres [@kabraBikeShareSystemsAccessibility2020] is correlated with bike share use, while other research has found that walking trips are less than 600 metres and rarely more than 1200 metres [@millwardActivetransportWalkingBehavior2013] or a median distance of 650 metres [@larsenQuarterMileReexamining2010]. For this reason, we experiment with various walking thresholds by conducting a sensitivity analysis to calculate accessibility at different walking times: 3 minutes, 5 minutes, 10 minutes, and 15 minutes. We repeat these calculations for both the current system and the original system to compare how accessibility changes at different thresholds with the addition of the equity stations.

```{r join-population-to-travel-time-data, echo=FALSE}
# current system with equity stations
ttm_walk <- left_join(ttm_walk, 
                      population_50x50 %>%
                        st_drop_geometry(),
                      by = "UID")
```

```{r join-sobi-station-to-travel-time-data, include=FALSE}
# current system with equity stations
ttm_walk <- ttm_walk %>% 
  left_join(sobi_hubs %>%
              st_drop_geometry() %>%
              dplyr::select(OBJECTID, 
                            RACKS_AMOU),
            by = c("OBJECTID" = "OBJECTID"))
```

```{r echo=FALSE}
#data frames for current and original systems
names(ttm_walk) <- c("UID", 
                     "hub", 
                     "travel_time",
                     "hub_type",
                     "hub_status",
                     "population",
                     "racks")
```

### Three Minutes

For the system without the equity stations, we remove the equity stations from the travel time matrix before calculating accessibility in at most 3 minutes walk.

```{r min-conventional, include=FALSE}
results_3min_conventional <- ttm_walk %>%
  dplyr::filter(hub_type == "Conventional" &
                  hub_status == "Active") %>%
  b2sfca(threshold = 3)
```

```{r min-all, include=FALSE}
results_3min_all <- ttm_walk %>%
  dplyr::filter(hub_status == "Active") %>%
  b2sfca(threshold = 3)
```

```{r min-sum-conventional, echo=FALSE}
sum(results_3min_conventional$los$los)
sum(results_3min_conventional$accessibility$accessibility)
```

```{r min-sum-all, echo=FALSE}
sum(results_3min_all$los$los)
sum(results_3min_all$accessibility$accessibility)
```

### Five Minutes

For the system without the equity stations, we remove the equity stations from the travel time matrix before calculating accessibility in at most 5 minutes walk.

```{r med-conventional, include=FALSE}
results_5min_conventional <- ttm_walk %>%
  dplyr::filter(hub_type == "Conventional" &
                  hub_status == "Active") %>%
  b2sfca(threshold = 5)
```

```{r med-all, include=FALSE}
results_5min_all <- ttm_walk %>%
  dplyr::filter(hub_status == "Active") %>%
  b2sfca(threshold = 5)
```

```{r, med-sum-conventional, echo=FALSE}
sum(results_5min_conventional$los$los)
sum(results_5min_conventional$accessibility$accessibility)
```

```{r med-sum-all, echo=FALSE}
sum(results_5min_all$los$los)
sum(results_5min_all$accessibility$accessibility)
```

### Ten Minutes

For the system without the equity stations, we remove the equity stations from the travel time matrix before calculating accessibility in at most 10 minutes.

```{r avg-conventional, include=FALSE}
results_10min_conventional <- ttm_walk %>%
  dplyr::filter(hub_type == "Conventional" &
                  hub_status == "Active") %>%
  b2sfca(threshold = 10)
```

```{r avg-all, include=FALSE}
results_10min_all <- ttm_walk %>%
  dplyr::filter(hub_status == "Active") %>%
  b2sfca(threshold = 10)
```

```{r avg-sum-conventional, echo=FALSE}
sum(results_10min_conventional$los$los)
sum(results_10min_conventional$accessibility$accessibility)
```

```{r, avg-sum-all, echo=FALSE}
sum(results_10min_all$los$los)
sum(results_10min_all$accessibility$accessibility)
```

### Fifteen Minutes

For the system without the equity stations, we remove the equity stations from the travel time matrix before calculating accessibility in at most 15 minutes walk.

```{r max-conventional, include=FALSE}
results_15min_conventional <- ttm_walk %>%
  dplyr::filter(hub_type == "Conventional" &
                  hub_status == "Active") %>%
  b2sfca(threshold = 15)
```

```{r max-all, include=FALSE}
results_15min_all <- ttm_walk %>%
  dplyr::filter(hub_status == "Active") %>%
  b2sfca(threshold = 15)
```

```{r max-sum-conventional, echo=FALSE}
sum(results_15min_conventional$los$los)
sum(results_15min_conventional$accessibility$accessibility)
```

```{r max-sum-all, echo=FALSE}
sum(results_15min_all$los$los)
sum(results_15min_all$accessibility$accessibility)
```

```{r, include=FALSE}
los <- rbind(data.frame(results_3min_all$los, system = "All stations", threshold = "3 min"),
             data.frame(results_3min_conventional$los, system = "Conventional", threshold = "3 min"),
             data.frame(results_5min_all$los, system = "All stations", threshold = "5 min"),
             data.frame(results_5min_conventional$los, system = "Conventional", threshold = "5 min"),
             data.frame(results_10min_all$los, system = "All stations", threshold = "10 min"),
             data.frame(results_10min_conventional$los, system = "Conventional", threshold = "10 min"),
             data.frame(results_15min_all$los, system = "All stations", threshold = "15 min"),
             data.frame(results_15min_conventional$los, system = "Conventional", threshold = "15 min"))

accessibility <- rbind(data.frame(results_3min_all$accessibility, system = "All stations", threshold = "3 min"),
             data.frame(results_3min_conventional$accessibility, system = "Conventional", threshold = "3 min"),
             data.frame(results_5min_all$accessibility, system = "All stations", threshold = "5 min"),
             data.frame(results_5min_conventional$accessibility, system = "Conventional", threshold = "5 min"),
             data.frame(results_10min_all$accessibility, system = "All stations", threshold = "10 min"),
             data.frame(results_10min_conventional$accessibility, system = "Conventional", threshold = "10 min"),
             data.frame(results_15min_all$accessibility, system = "All stations", threshold = "15 min"),
             data.frame(results_15min_conventional$accessibility, system = "Conventional", threshold = "15 min"))
```

```{r, include=FALSE}
los <- los %>%
  left_join(sobi_hubs %>%
              dplyr::select(OBJECTID),
            by = c("hub" = "OBJECTID")) %>%
  st_as_sf()

accessibility <- accessibility %>%
  left_join(population_50x50 %>%
              dplyr::select(UID),
            by = c("UID" = "UID")) %>%
  st_as_sf()
```

```{r figure-6, echo=FALSE, fig.align = 'center', out.width = "65%", fig.cap = "Accessibility at 3 minutes walk (minimum threshold) compared between current system with equity stations and the original system without equity stations."}
ggplot() +
  geom_sf(data = population_50x50,
          color = "lightgray") +
  geom_sf(data = accessibility %>%
            dplyr::filter(threshold == "3 min"),
       aes(color = accessibility)) +
  geom_sf(data = sobi_service,
          fill = NA) +
  scale_color_distiller(palette = "YlOrRd", 
                        direction = 1) +
  facet_grid(system ~ threshold)
```

```{r figure-7, echo=FALSE, fig.align = 'center', out.width = "65%", fig.cap = "Accessibility at 5 minutes walk (average threshold) compared between current system with equity stations and the original system without equity stations."}
#accessibility plot for current system with equity stations at 5 minutes walk
ggplot() +
  geom_sf(data = population_50x50,
          color = "lightgray") +
  geom_sf(data = accessibility %>%
            dplyr::filter(threshold == "5 min"),
       aes(color = accessibility)) +
  geom_sf(data = sobi_service,
          fill = NA) +
  scale_color_distiller(palette = "YlOrRd", 
                        direction = 1) +
  facet_grid(system ~ threshold)
```

```{r figure-8, echo=FALSE, fig.align = 'center', out.width = "65%", fig.cap = "Accessibility at 10 minutes walk (maximum threshold) compared between current system with equity stations and the original system without equity stations."}
#accessibility plot for current system with equity stations at 10 minutes walk
ggplot() +
  geom_sf(data = population_50x50,
          color = "lightgray") +
  geom_sf(data = accessibility %>%
            dplyr::filter(threshold == "10 min"),
       aes(color = accessibility)) +
  geom_sf(data = sobi_service,
          fill = NA) +
  scale_color_distiller(palette = "YlOrRd", 
                        direction = 1) +
  facet_grid(system ~ threshold)
```

```{r figure-9, echo=FALSE, fig.align = 'center', out.width = "65%", fig.cap = "Accessibility at 15 minutes walk (extreme threshold) compared between current system with equity stations and the original system without equity stations."}
#accessibility plot for current system with equity stations at 15 minutes walk
ggplot() +
  geom_sf(data = population_50x50,
          color = "lightgray") +
  geom_sf(data = accessibility %>%
            dplyr::filter(threshold == "15 min"),
       aes(color = accessibility)) +
  geom_sf(data = sobi_service,
          fill = NA) +
  scale_color_distiller(palette = "YlOrRd", 
                        direction = 1) +
  facet_grid(system ~ threshold)
```

## Comparison

Include table with total # of people who can reach a station within 3 minutes walk, 5 minutes, 10 minutes, and 15 minutes, to compare accessibility at different thresholds for both current and original system.

## Accessibility and Median Household Income

```{r, include=FALSE}
# drop geometry
test <- accessibility %>% st_drop_geometry()

# join accessibility to population cells
test <- test %>% left_join(population_50x50, by = "UID")
```

```{r, include=FALSE}
test0 <- population_50x50 %>%
  st_join(hamilton_da_2016 %>% dplyr::select(DA))
```

```{r, include=FALSE}
test <- test0 %>% left_join(test, by = "UID")
```

```{r, include=FALSE}
# object is a combination of accessibility, population_50x50, with DAs
test <- test %>% drop_na()
```

```{r, include=FALSE}
test <- subset(test, select = -c(1)) %>% dplyr::select(-geometry.y)
```

```{r, include=FALSE}
accessibility <- test
```

```{r, include=FALSE}
min_all <- accessibility %>%
            dplyr::filter(threshold == "3 min") %>% 
            dplyr::filter(system == "All stations")

min_con <- accessibility %>%
            dplyr::filter(threshold == "3 min") %>%
            dplyr::filter(system == "Conventional")

avg_all <- accessibility %>%
            dplyr::filter(threshold == "5 min") %>% 
            dplyr::filter(system == "All stations")

avg_con <- accessibility %>%
            dplyr::filter(threshold == "5 min") %>%
            dplyr::filter(system == "Conventional")

max_all <- accessibility %>%
            dplyr::filter(threshold == "10 min") %>% 
            dplyr::filter(system == "All stations")

max_con <- accessibility %>%
            dplyr::filter(threshold == "10 min") %>%
            dplyr::filter(system == "Conventional")

ext_all <- accessibility %>%
            dplyr::filter(threshold == "15 min") %>% 
            dplyr::filter(system == "All stations")

ext_con <- accessibility %>%
            dplyr::filter(threshold == "15 min") %>%
            dplyr::filter(system == "Conventional")

```

```{r, include=FALSE}
# aggregate population and accessibility by DA
min_all <- min_all %>%
           group_by(DA) %>%
             summarize(population = sum(population.y),
             accessibility = sum(accessibility)) %>%
           st_join(hamilton_da_2016 %>% dplyr::select(median_total_income))

min_con <- min_con %>%
           group_by(DA) %>%
             summarize(population = sum(population.y),
             accessibility = sum(accessibility)) %>%
           st_join(hamilton_da_2016 %>% dplyr::select(median_total_income))

avg_all <- avg_all %>%
           group_by(DA) %>%
             summarize(population = sum(population.y),
             accessibility = sum(accessibility)) %>%
           st_join(hamilton_da_2016 %>% dplyr::select(median_total_income))

avg_con <- avg_con %>%
           group_by(DA) %>%
             summarize(population = sum(population.y),
             accessibility = sum(accessibility)) %>%
           st_join(hamilton_da_2016 %>% dplyr::select(median_total_income))

max_all <- max_all %>%
           group_by(DA) %>%
             summarize(population = sum(population.y),
             accessibility = sum(accessibility)) %>%
           st_join(hamilton_da_2016 %>% dplyr::select(median_total_income))

max_con <- max_con %>%
           group_by(DA) %>%
             summarize(population = sum(population.y),
             accessibility = sum(accessibility)) %>%
           st_join(hamilton_da_2016 %>% dplyr::select(median_total_income))

ext_all <- ext_all %>%
           group_by(DA) %>%
             summarize(population = sum(population.y),
             accessibility = sum(accessibility)) %>%
           st_join(hamilton_da_2016 %>% dplyr::select(median_total_income))

ext_con <- ext_con %>%
           group_by(DA) %>%
             summarize(population = sum(population.y),
             accessibility = sum(accessibility)) %>%
           st_join(hamilton_da_2016 %>% dplyr::select(median_total_income))
```

```{r}
min_all <- min_all %>%
  st_drop_geometry() %>%
  left_join(hamilton_da_2016 %>% 
              dplyr::select(DA, geometry),
            by = "DA") %>%
  st_as_sf()

min_con <- min_con %>%
  st_drop_geometry() %>%
  left_join(hamilton_da_2016 %>% 
              dplyr::select(DA, geometry),
            by = "DA") %>%
  st_as_sf()

avg_all <- avg_all %>%
  st_drop_geometry() %>%
  left_join(hamilton_da_2016 %>% 
              dplyr::select(DA, geometry),
            by = "DA") %>%
  st_as_sf()

avg_con <- avg_con %>%
  st_drop_geometry() %>%
  left_join(hamilton_da_2016 %>% 
              dplyr::select(DA, geometry),
            by = "DA") %>%
  st_as_sf()

max_all <- max_all %>%
  st_drop_geometry() %>%
  left_join(hamilton_da_2016 %>% 
              dplyr::select(DA, geometry),
            by = "DA") %>%
  st_as_sf()

max_con <- max_con %>%
  st_drop_geometry() %>%
  left_join(hamilton_da_2016 %>% 
              dplyr::select(DA, geometry),
            by = "DA") %>%
  st_as_sf()

ext_all <- ext_all %>%
  st_drop_geometry() %>%
  left_join(hamilton_da_2016 %>% 
              dplyr::select(DA, geometry),
            by = "DA") %>%
  st_as_sf()

ext_con <- ext_con %>%
  st_drop_geometry() %>%
  left_join(hamilton_da_2016 %>% 
              dplyr::select(DA, geometry),
            by = "DA") %>%
  st_as_sf()
```

```{r}
data_min_all <- bi_class(min_all,
                 x = accessibility, 
                 y = median_total_income, 
                 style = "quantile", 
                 dim = 3) %>%
  st_as_sf()

data_min_con <- bi_class(min_con,
                 x = accessibility, 
                 y = median_total_income, 
                 style = "quantile", 
                 dim = 3) %>%
  st_as_sf()

data_avg_all <- bi_class(avg_all,
                 x = accessibility, 
                 y = median_total_income, 
                 style = "quantile", 
                 dim = 3) %>%
  st_as_sf()

data_avg_con <- bi_class(avg_con,
                 x = accessibility, 
                 y = median_total_income, 
                 style = "quantile", 
                 dim = 3) %>%
  st_as_sf()

data_max_all <- bi_class(max_all,
                 x = accessibility, 
                 y = median_total_income, 
                 style = "quantile", 
                 dim = 3) %>%
  st_as_sf()

data_max_con <- bi_class(max_con,
                 x = accessibility, 
                 y = median_total_income, 
                 style = "quantile", 
                 dim = 3) %>%
  st_as_sf()

data_ext_all <- bi_class(ext_all,
                 x = accessibility, 
                 y = median_total_income, 
                 style = "quantile", 
                 dim = 3) %>%
  st_as_sf()

data_ext_con <- bi_class(ext_con,
                 x = accessibility, 
                 y = median_total_income, 
                 style = "quantile", 
                 dim = 3) %>%
  st_as_sf()
```
```{r figure-10, echo=FALSE, fig.align = 'center', out.width = "65%", fig.cap = "Accessibility at 3 minutes walk (minimum threshold) varying by median total income in the current system with equity stations."}
map_min_all <- ggplot() +
  geom_sf(data = data_min_all, mapping = aes(fill = bi_class), color = "white", size = 0.1, show.legend = FALSE) +
  bi_scale_fill(pal = "DkBlue", dim = 3) +
  bi_theme()

legend <- bi_legend(pal = "DkBlue",
                    dim = 3,
                    xlab = "Higher accessibility ",
                    ylab = "Higher income",
                    size = 6)

cowplot::ggdraw() +
  cowplot::draw_plot(map_min_all, 0, 0, 1, 1) +
  cowplot::draw_plot(legend, 0.05, .6, 0.2, 0.2)
```

```{r figure-11, echo=FALSE, fig.align = 'center', out.width = "65%", fig.cap = "Accessibility at 3 minutes walk (minimum threshold) varying by median total income in the original system with conventional stations."}
map_min_con <- ggplot() +
  geom_sf(data = data_min_con, mapping = aes(fill = bi_class), color = "white", size = 0.1, show.legend = FALSE) +
  bi_scale_fill(pal = "DkBlue", dim = 3) +
  bi_theme()

legend <- bi_legend(pal = "DkBlue",
                    dim = 3,
                    xlab = "Higher accessibility ",
                    ylab = "Higher income",
                    size = 6)

cowplot::ggdraw() +
  cowplot::draw_plot(map_min_con, 0, 0, 1, 1) +
  cowplot::draw_plot(legend, 0.05, .6, 0.2, 0.2)
```

```{r figure-12, echo=FALSE, fig.align = 'center', out.width = "65%", fig.cap = "Accessibility at 5 minutes walk (average threshold) varying by median total income in the current system with equity stations."}
map_avg_all <- ggplot() +
  geom_sf(data = data_avg_all, mapping = aes(fill = bi_class), color = "white", size = 0.1, show.legend = FALSE) +
  bi_scale_fill(pal = "DkBlue", dim = 3) +
  bi_theme()

legend <- bi_legend(pal = "DkBlue",
                    dim = 3,
                    xlab = "Higher accessibility ",
                    ylab = "Higher income",
                    size = 6)

cowplot::ggdraw() +
  cowplot::draw_plot(map_avg_all, 0, 0, 1, 1) +
  cowplot::draw_plot(legend, 0.05, .6, 0.2, 0.2)
```

```{r figure-13, echo=FALSE, fig.align = 'center', out.width = "65%", fig.cap = "Accessibility at 5 minutes walk (average threshold) varying by median total income in the original system with conventional stations."}
map_avg_con <- ggplot() +
  geom_sf(data = data_avg_con, mapping = aes(fill = bi_class), color = "white", size = 0.1, show.legend = FALSE) +
  bi_scale_fill(pal = "DkBlue", dim = 3) +
  bi_theme()

legend <- bi_legend(pal = "DkBlue",
                    dim = 3,
                    xlab = "Higher accessibility ",
                    ylab = "Higher income",
                    size = 6)

cowplot::ggdraw() +
  cowplot::draw_plot(map_avg_con, 0, 0, 1, 1) +
  cowplot::draw_plot(legend, 0.05, .6, 0.2, 0.2)
```

```{r figure-14, echo=FALSE, fig.align = 'center', out.width = "65%", fig.cap = "Accessibility at 10 minutes walk (maximum threshold) varying by median total income in the current system with equity stations."}
map_max_all <- ggplot() +
  geom_sf(data = data_max_all, mapping = aes(fill = bi_class), color = "white", size = 0.1, show.legend = FALSE) +
  bi_scale_fill(pal = "DkBlue", dim = 3) +
  bi_theme()

legend <- bi_legend(pal = "DkBlue",
                    dim = 3,
                    xlab = "Higher accessibility ",
                    ylab = "Higher income",
                    size = 6)

cowplot::ggdraw() +
  cowplot::draw_plot(map_max_all, 0, 0, 1, 1) +
  cowplot::draw_plot(legend, 0.05, .6, 0.2, 0.2)
```

```{r figure-15, echo=FALSE, fig.align = 'center', out.width = "65%", fig.cap = "Accessibility at 10 minutes walk (maximum threshold) varying by median total income in the original system with conventional stations."}
map_max_con <- ggplot() +
  geom_sf(data = data_max_con, mapping = aes(fill = bi_class), color = "white", size = 0.1, show.legend = FALSE) +
  bi_scale_fill(pal = "DkBlue", dim = 3) +
  bi_theme()

legend <- bi_legend(pal = "DkBlue",
                    dim = 3,
                    xlab = "Higher accessibility ",
                    ylab = "Higher income",
                    size = 6)

cowplot::ggdraw() +
  cowplot::draw_plot(map_max_con, 0, 0, 1, 1) +
  cowplot::draw_plot(legend, 0.05, .6, 0.2, 0.2)
```

```{r figure-16, echo=FALSE, fig.align = 'center', out.width = "65%", fig.cap = "Accessibility at 15 minutes walk (extreme threshold) varying by median total income in the current system with equity stations."}
map_ext_all <- ggplot() +
  geom_sf(data = data_ext_all, mapping = aes(fill = bi_class), color = "white", size = 0.1, show.legend = FALSE) +
  bi_scale_fill(pal = "DkBlue", dim = 3) +
  bi_theme()

legend <- bi_legend(pal = "DkBlue",
                    dim = 3,
                    xlab = "Higher accessibility ",
                    ylab = "Higher income",
                    size = 6)

cowplot::ggdraw() +
  cowplot::draw_plot(map_ext_all, 0, 0, 1, 1) +
  cowplot::draw_plot(legend, 0.05, .6, 0.2, 0.2)
```

```{r figure-17, echo=FALSE, fig.align = 'center', out.width = "65%", fig.cap = "Accessibility at 15 minutes walk (extreme threshold) varying by median total income in the original system with conventional stations."}
map_ext_con <- ggplot() +
  geom_sf(data = data_ext_con, mapping = aes(fill = bi_class), color = "white", size = 0.1, show.legend = FALSE) +
  bi_scale_fill(pal = "DkBlue", dim = 3) +
  bi_theme()

legend <- bi_legend(pal = "DkBlue",
                    dim = 3,
                    xlab = "Higher accessibility ",
                    ylab = "Higher income",
                    size = 6)

cowplot::ggdraw() +
  cowplot::draw_plot(map_ext_con, 0, 0, 1, 1) +
  cowplot::draw_plot(legend, 0.05, .6, 0.2, 0.2)
```

```{r, include=FALSE}
sum(population_50x50$population)
sum(min_all$population)
sum(avg_all$population)
sum(max_all$population)
sum(ext_all$population)
sum(min_con$population)
sum(avg_con$population)
sum(max_con$population)
sum(ext_con$population)
```

```{r}
summary(data_max_all)
```

```{r}
demographics_minimum <- rbind(data.frame(min_all %>%  
                                        dplyr::filter(median_total_income >= "38486") %>% summarise(population = sum(population)), accessibility = "min", income = "Quantile 1", system = "All Stations"),
             data.frame(min_all %>% dplyr::filter(median_total_income >= "46336") %>% summarise(population = sum(population)), accessibility = "min", income = "Quantile 2", system = "All Stations"),
             data.frame(min_all %>% dplyr::filter(median_total_income >= "56640") %>% summarise(population = sum(population)), accessibility = "min", income = "Quantile 3", system = "All Stations"),
             data.frame(min_con %>% dplyr::filter(median_total_income >= "38288") %>% summarise(population = sum(population)), accessibility = "min", income = "Quantile 1", system = "Conventional"),
             data.frame(min_con %>% dplyr::filter(median_total_income >= "45696") %>% summarise(population = sum(population)), accessibility = "min", income = "Quantile 2", system = "Conventional"),
             data.frame(min_con %>% dplyr::filter(median_total_income >= "57664") %>% summarise(population = sum(population)), accessibility = "min", income = "Quantile 3", system = "Conventional"))
```

```{r}
demographics_maximum <- rbind(data.frame(avg_all %>%  
                                        dplyr::filter(median_total_income >= "38752") %>% summarise(population = sum(population)), accessibility = "min", income = "Quantile 1", system = "All Stations"),
             data.frame(avg_all %>% dplyr::filter(median_total_income >= "47040") %>% summarise(population = sum(population)), accessibility = "min", income = "Quantile 2", system = "All Stations"),
             data.frame(avg_all %>% dplyr::filter(median_total_income >= "58912") %>% summarise(population = sum(population)), accessibility = "min", income = "Quantile 3", system = "All Stations"),
             data.frame(avg_con %>% dplyr::filter(median_total_income >= "38422") %>% summarise(population = sum(population)), accessibility = "min", income = "Quantile 1", system = "Conventional"),
             data.frame(avg_con %>% dplyr::filter(median_total_income >= "45696") %>% summarise(population = sum(population)), accessibility = "min", income = "Quantile 2", system = "Conventional"),
             data.frame(avg_con %>% dplyr::filter(median_total_income >= "59264") %>% summarise(population = sum(population)), accessibility = "min", income = "Quantile 3", system = "Conventional"))
```

```{r}
demographics_minimum <- rbind(data.frame(min_all %>%  
                                        dplyr::filter(median_total_income >= "38486") %>% summarise(population = sum(population)), accessibility = "min", income = "Quantile 1", system = "All Stations"),
             data.frame(min_all %>% dplyr::filter(median_total_income >= "46336") %>% summarise(population = sum(population)), accessibility = "min", income = "Quantile 2", system = "All Stations"),
             data.frame(min_all %>% dplyr::filter(median_total_income >= "56640") %>% summarise(population = sum(population)), accessibility = "min", income = "Quantile 3", system = "All Stations"),
             data.frame(min_con %>% dplyr::filter(median_total_income >= "38288") %>% summarise(population = sum(population)), accessibility = "min", income = "Quantile 1", system = "Conventional"),
             data.frame(min_con %>% dplyr::filter(median_total_income >= "45696") %>% summarise(population = sum(population)), accessibility = "min", income = "Quantile 2", system = "Conventional"),
             data.frame(min_con %>% dplyr::filter(median_total_income >= "57664") %>% summarise(population = sum(population)), accessibility = "min", income = "Quantile 3", system = "Conventional"))
```

```{r, include=FALSE}
sum(population_50x50$population)
sum(min_all$population)
sum(avg_all$population)
sum(max_all$population)
sum(ext_all$population)
sum(min_con$population)
sum(avg_con$population)
sum(max_con$population)
sum(ext_con$population)
```

```{r table-2, echo=FALSE, fig.align = 'center', out.width = "65%", fig.cap = "Population that can reach at least one bike share station at different thresholds in the current system with equity stations and original system with only conventional stations."}
data_tbl <- data.frame(
  System = c("All Stations", "Conventional"),
  Minimum = c("48,725", "43,238"),
  Average = c("84,655", "75,026"),
  Maximum = c("111,680", "104,298"),
  Extreme = c("118,581", "115,344")
)

kbl(data_tbl) %>%
  kable_paper(full_width = F) %>%
  column_spec(1, bold = T, border_right = T) %>%
  kable_styling(bootstrap_options = "striped") %>%
  add_header_above(c(" " = 1, "3 Minutes" = 1, "5 Minutes" = 1, "10 Minutes" = 1, "15 Minutes" = 1))
```


Discussion
===================

Our analysis demonstrates that the stations added to Hamilton's public bicycle share program to increase equity for disadvantaged neighbourhoods achieved their goal by increasing accessibility, albeit only modestly. 

By implementing equity stations in more areas with lower median household income in Hamilton, the PBSP has achieved greater horizontal equity by extending the spatial distribution of bicycles across the city. Under the the conditions of the original system, which did not have equity stations, the level of service was _X_. With the addition of twelve equity stations, the level of service increased to _X_.

However, we found that dissemination areas with lower median household income do not necessarily have greater access to the program and that spatial disparities still persist. Under the the conditions of the original system, which did not have equity stations, _X%_ of dissemination areas (or _X%_ of the population) within the core service area with median household income less than 40,000 Canadian dollars could access at least one bicycle share station within 10 minutes walk. Only _X%_ of dissemination areas (or _X%_ of the population) with median household income less than 40,000 Canadian dollars could access at least one bicycle share station within 3 or 5 minutes walk.

Similar to other studies, we find that areas with higher median household income have greater accessibility to Hamilton Bike Share. Our findings align with other studies that have found disparities in station or bike location along income lines in New York City [@babagoliExploringHealthSpatial2019], Tampa [@chenExploringEquityPerformance2019], and Seattle [@mooneyFreedomStationSpatial2019]. 

# Study Limitations

This paper did not examine or compare ridership data between conventional and equity stations. Therefore, further research is needed to determine whether this encouraged more cycling for low-income individuals living near equity stations. Other studies have specifically looked at differences in trip type, frequency, or length among users from disadvantaged neighbourhoods [@caspiBikesharingPhiladelphiaLowerincome2019; @qianBikesharingEquityDisadvantaged2020; @wangNeighborhoodSociodemographicCharacteristics2019], but our analysis is limited by the lack of accessible data to conduct similar analyses for Hamilton Bike Share.

Conclusion
===================

The addition of specific equity stations to the public bicycle share program in Hamilton, Ontario had the net effect of increasing accessibility and reducing both horizontal and vertical inequities. In particular, accessibility improved the most for _X_ income groups at _X_ thresholds, but the gains were only modest as the threshold increased ( _2.10_ bicycles/person with equity stations vs _1.97_ bicycles/person without equity stations). Congestion effects were observed at higher thresholds, with accessibility decreasing significantly once the catchment area is increased to 10 minutes walking ( _X_ ). We identified specific areas that would benefit from an increased supply of bicycles which make them ideal candidates for new equity stations. In this way, our paper has made contributions in a positive way by applying an intuitive and useful approach to measure accessibility, and in a normative way by serving to inform future investments in cycle infrastructure.

Wang and Lindsey [-@wangNewBikeShare2019] have noted that there is a lack of research that examines how bike share users' behaviour changes as a result of program changes to station locations or improvements in accessibility. As such, a logical next step to this research is to examine whether Hamilton Bike Share's equity stations increased ridership or resulted in new memberships in areas that were previously under-served. An examination of the types of trips undertaken by residents in these areas would also be informative, such as the study undertaken by Caspi and Norland [-@caspiBikesharingPhiladelphiaLowerincome2019] after bike share stations were implemented in low-income Philadelphia neighbourhoods. The bulk of cycling facilities that have been built in Hamilton to date located in the core service area near the conventional stations. It would be worthwhile to explore the route choice of bike share trips departing or ending at the equity stations and to identify factors that specifically influence trips from these stations, which would extend existing studies conducted by Scott and colleagues [@luUnderstandingBikeShare2018; @scottWhatFactorsInfluence2019; @scottRouteChoiceBike2021]. This paper, combined with additional studies such as those conceptualized above, would serve as a valuable case study for Hamilton and other cities with PBSPs who wish to evaluate and address spatial inequities in accessibility and transportation options in urban areas.

References {#references .unnumbered}
===================
